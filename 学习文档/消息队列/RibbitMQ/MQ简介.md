# MQ
## MQ的不足

1. 系统更复杂，多了一个MQ组件
2. 消息传递路径更长，延时会增加
3. 消息可靠性和重复性互为矛盾，消息不丢不重难以同时保证
4. 上游无法知道下游的执行结果，这一点是很致命的

结论：
	调用方实时依赖执行结果的业务场景，请使用调用，而不是MQ。

## 什么时候使用MQ

1. 数据驱动的任务依赖
	1. 任务之间有一定的依赖关系
	2. 比如：
		1. 	task3需要使用task2的输出作为输入
		2. 	task2需要使用task1的输出作为输入
	3. 坏处
		1. 如果有一个任务执行时间超过了预留buffer的时间，将会得到错误的结果，因为后置任务不清楚前置任务是否执行成功，此时要手动重跑任务，还有可能要调整排班表
		2. 总任务的执行时间很长，总是要预留很多buffer，如果前置任务提前完成，后置任务不会提前开始 
		3. 如果一个任务被多个任务依赖，这个任务将会称为关键路径，排班表很难体现依赖关系，容易出错
		4. 如果有一个任务的执行时间要调整，将会有多个任务的执行时间要调整

	4. 优点
		1. 不需要预留buffer，上游任务执行完，下游任务总会在第一时间被执行
		2. 依赖多个任务，被多个任务依赖都很好处理，只需要订阅相关消息即可
		3. 有任务执行时间变化，下游任务都不需要调整执行时间

2. 上游不关心执行结果
	1. 坏处
		1. 帖子发布流程的执行时间增加了
		2. 下游服务当机，可能导致帖子发布服务受影响，上下游逻辑+物理依赖严重
		3. 每当增加一个需要知道“帖子发布成功”信息的下游，修改代码的是帖子发布服务，这一点是最恶心的，属于架构设计中典型的依赖倒转，谁用过谁痛谁知道
	2. 优点
		1. 上游执行时间短
		2. 上下游逻辑+物理解耦，除了与MQ有物理连接，模块之间都不相互依赖
		3. 新增一个下游消息关注方，上游不需要修改任何代码

3. 总结
	1. 	什么时候不使用MQ？
		1. 上游实时关注执行结果
	2. 什么时候使用MQ？
		1. 数据驱动的任务依赖
		2. 上游不关心多下游执行结果
		3. 异步返回执行时间长 	
